# MIMIC-IV-ECG 数据集多标签分类分析报告

## 概述

本报告详细分析了MIMIC-IV-ECG诊断心电图匹配子集数据，旨在为创建科学的多标签分类数据集提供全面的指导。

## 数据集结构分析

### 基本信息
- **数据集位置**: `/Users/zixiang/ecg/mimic-iv-ecg-diagnostic-electrocardiogram-matched-subset-1.0/`
- **核心文件**: `machine_measurements.csv`
- **数据规模**: 800,035 条心电图记录
- **诊断报告列**: 18个 (report_0 到 report_17)
- **独特诊断术语**: 3,862 种
- **诊断实例总数**: 2,760,117 个

### 关键数据文件

1. **machine_measurements.csv**
   - 主要的诊断数据文件
   - 包含心电图机器生成的诊断报告
   - 包含生理测量参数 (RR间期、QRS轴等)

2. **waveform_note_links.csv**
   - 连接心电图波形文件与临床notes
   - 提供时间戳和患者标识符

3. **record_list.csv**
   - 记录清单，包含文件路径信息

## 诊断报告列分析

### 报告列非空统计
| 报告列 | 非空记录数 | 占比 |
|--------|------------|------|
| report_0 | 800,034 | 100.00% |
| report_1 | 601,108 | 75.14% |
| report_2 | 525,908 | 65.74% |
| report_3 | 393,551 | 49.19% |
| report_4 | 227,550 | 28.44% |
| report_5 | 122,212 | 15.28% |

### 最常见诊断术语 (Top 10)

1. **Abnormal ECG**: 355,656 次 (12.89%)
2. **Sinus rhythm**: 324,175 次 (11.74%)
3. **Borderline ECG**: 171,372 次 (6.21%)
4. **Normal ECG**: 116,608 次 (4.22%)
5. **Left axis deviation**: 75,280 次 (2.73%)
6. **Sinus bradycardia**: 60,062 次 (2.18%)
7. **Sinus tachycardia**: 42,002 次 (1.52%)
8. **Inferior infarct - age undetermined**: 41,581 次 (1.51%)
9. **Low QRS voltages in precordial leads**: 40,238 次 (1.46%)
10. **Prolonged QT interval**: 37,034 次 (1.34%)

## 多标签模式分析

### 标签数量分布
- **96.32%** 的记录具有多个诊断标签
- **平均每条记录**: 3.45 个标签
- **最大标签数**: 17 个

| 标签数量 | 记录数 | 占比 |
|----------|--------|------|
| 1个标签 | 29,470 | 3.68% |
| 2个标签 | 205,403 | 25.67% |
| 3个标签 | 233,413 | 29.18% |
| 4个标签 | 158,596 | 19.82% |
| 5个标签 | 96,619 | 12.08% |

### 最常见诊断组合
1. **Normal ECG + Sinus rhythm**: 92,098 次 (11.95%)
2. **Normal ECG except for rate + Sinus bradycardia**: 18,692 次 (2.43%)
3. **Normal ECG + Sinus rhythm.**: 14,511 次 (1.88%)

## 心脏疾病分类体系

### 主要疾病类别分布

1. **心律失常 (ARRHYTHMIA)**: 792,369 次 (28.71%)
   - 窦性心律、心动过速、心动过缓、房颤等

2. **ST-T波变化**: 139,240 次 (5.04%)
   - T波变化、ST段抬高/压低等

3. **传导异常 (CONDUCTION)**: 143,965 次 (5.22%)
   - 束支传导阻滞、房室传导阻滞等

4. **正常/异常**: 621,439 次 (22.51%)
   - 正常心电图、异常心电图、临界异常等

5. **缺血性改变**: 111,389 次 (4.04%)
   - 心肌缺血、心肌梗死等

6. **心室肥厚**: 121,110 次 (4.39%)
   - 左/右心室肥厚、心房扩大等

## 多标签数据集创建方案

### 1. 标签分类体系设计

创建了九大主要疾病类别：

- **NORMAL**: 正常心电图
- **ARRHYTHMIA**: 心律失常（含5个子类别）
- **CONDUCTION_ABNORMALITY**: 传导异常（含3个子类别）
- **MYOCARDIAL_INFARCTION**: 心肌梗死（含4个子类别）
- **ISCHEMIA**: 心肌缺血
- **HYPERTROPHY**: 心肌肥厚（含3个子类别）
- **REPOLARIZATION_ABNORMALITY**: 复极异常（含3个子类别）
- **LOW_VOLTAGE**: 低电压（含2个子类别）
- **AXIS_DEVIATION**: 电轴偏移（含2个子类别）
- **BORDERLINE_ABNORMAL**: 临界异常

### 2. 数据预处理策略

1. **文本标准化**:
   - 转换为小写
   - 移除标点符号
   - 标准化医学缩写 (ECG, LVH, RBBB等)

2. **诊断术语映射**:
   - 使用正则表达式模式匹配
   - 排除否定性表述
   - 处理不确定性修饰词

3. **层次化标签结构**:
   - 主类别 + 子类别的层次体系
   - 支持不同粒度的分类任务

### 3. 创建的数据集文件

#### 示例数据集 (10,000条记录)
- **文件**: `mimic_ecg_multilabel_dataset.csv`
- **总记录数**: 10,000
- **有标签记录**: 9,938 (99.38%)
- **平均标签数**: 3.99
- **最大标签数**: 15
- **唯一标签数**: 32

#### 二进制标签矩阵
- **文件**: `mimic_ecg_binary_labels.csv`
- **矩阵维度**: 10,000 × 32
- **格式**: 便于机器学习模型训练的二进制矩阵

#### 配置文件
- **文件**: `mimic_ecg_multilabel_dataset_config.json`
- **内容**: 标签映射规则、频率统计、数据集统计信息

### 4. 标签分布统计 (示例数据集)

| 标签 | 频次 | 占比 |
|------|------|------|
| NORMAL | 4,904 | 49.04% |
| BORDERLINE_ABNORMAL | 4,757 | 47.57% |
| ARRHYTHMIA | 4,084 | 40.84% |
| MYOCARDIAL_INFARCTION | 3,445 | 34.45% |
| CONDUCTION_ABNORMALITY | 2,457 | 24.57% |
| REPOLARIZATION_ABNORMALITY | 2,319 | 23.19% |
| ISCHEMIA | 1,527 | 15.27% |
| AXIS_DEVIATION | 1,495 | 14.95% |

## 科学性多标签分类建议

### 1. 标签选择策略

**基于频率的选择**:
- 选择出现频率 ≥ 1000 的诊断作为主要标签
- 共214种高频诊断术语
- 确保标签的统计显著性

**基于临床意义的选择**:
- 按照心脏疾病的病理生理机制分类
- 考虑诊断的临床重要性
- 保持标签间的独立性和互斥性

### 2. 数据质量控制

**诊断一致性**:
- 处理同一概念的不同表述
- 统一时态和修饰词
- 消除机器报告的格式差异

**标签平衡性**:
- 监控各类别的分布
- 考虑使用采样技术平衡数据
- 处理长尾分布问题

### 3. 评估指标建议

**多标签分类评估**:
- **Hamming Loss**: 评估标签级别的分类错误
- **Subset Accuracy**: 评估完全正确的预测比例
- **Micro/Macro F1**: 评估整体和各类别的性能
- **Label Ranking Loss**: 评估标签排序质量

**临床相关性评估**:
- **类别特异性指标**: 针对重要心脏疾病的专项评估
- **临床一致性**: 与专家诊断的一致性分析
- **时间一致性**: 同一患者不同时间点的诊断一致性

### 4. 实施建议

**分阶段实施**:
1. **阶段一**: 使用主要类别进行粗粒度分类
2. **阶段二**: 引入子类别进行细粒度分类
3. **阶段三**: 结合波形数据进行多模态学习

**模型选择**:
- **多标签分类算法**: Binary Relevance, Classifier Chains, ML-kNN
- **深度学习模型**: 多输出CNN/RNN, Attention机制
- **集成方法**: 结合多种算法提高鲁棒性

**验证策略**:
- **时间分割**: 按时间序列分割训练/测试集
- **患者分割**: 确保同一患者的数据不跨集
- **交叉验证**: 使用分层采样确保标签分布一致

## 结论

MIMIC-IV-ECG数据集为创建大规模多标签心电图分类数据集提供了丰富的资源。通过科学的标签体系设计、严格的数据预处理和合适的评估策略，可以构建高质量的多标签分类数据集，为心电图自动诊断研究提供坚实基础。

### 关键优势
1. **大规模数据**: 80万条记录提供充足的训练数据
2. **丰富标签**: 平均3.45个标签支持复杂多标签学习
3. **临床真实性**: 来自实际临床环境的诊断数据
4. **标准化处理**: 系统化的标签分类和预处理流程

### 文件清单
- 分析脚本: `/Users/zixiang/PycharmProjects/Master-Thesis/analyze_ecg_diagnoses.py`
- 数据集创建器: `/Users/zixiang/PycharmProjects/Master-Thesis/multilabel_dataset_creator.py`
- 多标签数据集: `/Users/zixiang/PycharmProjects/Master-Thesis/mimic_ecg_multilabel_dataset.csv`
- 二进制标签矩阵: `/Users/zixiang/PycharmProjects/Master-Thesis/mimic_ecg_binary_labels.csv`
- 配置文件: `/Users/zixiang/PycharmProjects/Master-Thesis/mimic_ecg_multilabel_dataset_config.json`

这些工具和数据集为后续的多标签心电图分类研究奠定了坚实的基础。